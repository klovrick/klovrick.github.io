// JSON of all text content, just collapse it
var data =
    [
        {
            "#": "0",
            "Section": "Keyser Soze: Origins",
            "Run time": "59m 10s",
            "Movie time": "Time unknown",
            "Location": "Turkey",
            "Title": "Keyser Soze disappears into hiding after incident with Hungarian&nbsp;mob",
            "Description": "The Hungarian mob breaks into then small-time gangster Keyser Soze's house in Turkey, rapes his wife, and holds his family hostage. Instead of giving in to the mob, Soze kills both his family and the mobsters. After massacring everyone who had a connection to the mob, he disappears. There is no record of Soze’s existence or whereabouts past this&nbsp;point.",
            "Related event 1": "20",
            "Image A": "-50",
            "Image B": "-45"
        },
        {
            "#": "1",
            "Section": "Prologue",
            "Run time": "53m 35s",
            "Movie time": "1981",
            "Location": "Buffalo, NY",
            "Title": "Keaton hijacks Soze-affiliated truck in&nbsp;Buffalo",
            "Description": "Corrupt NYPD officer Dean Keaton hijacks a truck carrying steel parts to Pakistan for a nuclear reactor. It is later revealed that the truck was part of Keyser Soze’s&nbsp;ring.",
            "Related event 1": "16",
            "Bg Image": "-50"
        },
        {
            "#": "2",
            "Run time": "38m 15s",
            "Movie time": "Time unknown",
            "Title": "Keaton convicted of fraud, kills three prisoners during&nbsp;sentence",
            "Description": "NYPD Internal Affairs charges Keaton with three counts of murder while he is working in the police force. Though he is indicted a total of seven times, in each case the witnesses either reverse their testimony or die before testifying in court. Finally, he is convicted and sentenced to five years in prison. While doing his time, Keaton kills a mobster named Spook Hollis, along with two other&nbsp;prisoners.",
            "Related event 1": "12",
            "Bg Image": "-50"
        },
        {
            "#": "3",
            "Run time": "39m 0s",
            "Movie time": "2 years ago",
            "Title": "Keaton \"dies\" in warehouse&nbsp;accident",
            "Description": "During an investigation into the murder of a witness in his case, Keaton is supposedly killed in a warehouse gas leak accident. The two witnesses of Keaton’s “accident” die in suspicous circumstances. One commits suicide, while the other falls down an open elevator&nbsp;shaft.",
            "Bg Image": "-50"
        },
        {
            "#": "4",
            "Run time": "1h 22m 50s",
            "Movie time": "Last year",
            "Location": "New York",
            "Title": "Arturo Marquez caught, names Keyser Soze, others to avoid hefty&nbsp;sentence",
            "Description": "After being arrested in New York for trafficking, Argentinian smuggler Arturo Marquez escapes pre-trial detention twice. When finally re-captured, he names 50 people, including Keyser Soze, to avoid a harsh prison sentence. New York district attorney Edie Finnerman is brought in by a lawyer named Kobayashi to advise on the court&nbsp;case.",
            "Related event 1": "18",
            "Related event 2": "20",
            "Related event 3": "24",
            "Related event 4": "29",
            "Bg Image": "-50"
        },
        {
            "#": "5",
            "Run time": "54m 25s",
            "Movie time": "9 months ago",
            "Title": "Verbal scams Keyser Soze-affiliated courier out of&nbsp;$62k",
            "Description": "Small time scammer and cripple Roger \"Verbal\" Kint ensnares a man in an elaborate confidence scam. Unbeknownst to him, the man is employed by Turkish crime lord Keyser Soze and had given Soze's money to&nbsp;Verbal.",
            "Related event 1": "16",
            "Bg Image": "-50"
        },
        {
            "#": "6",
            "Run time": "53m 55s",
            "Movie time": "Earlier this year",
            "Location": "Newark",
            "Title": "Fenster, McManus hijack Keyser Soze-affiliated&nbsp;airplane",
            "Description": "Contract criminals Fred Fenster and Michael McManus accidentally sabotage a Keyser Soze operation involving a plane was bound for Pakistan carrying gold and platinum&nbsp;wiring.",
            "Related event 1": "16",
            "Bg Image": "-50"
        },
        {
            "#": "7",
            "Run time": "5m 10s / 54m 10s",
            "Movie time": "2 months ago",
            "Location": "Queens",
            "Title": "Hockney hijacks Keyser Soze-affiliated&nbsp;truck",
            "Description": "Contract criminal Todd Hockney crosses Keyser Soze by hijacking a truck carrying stripped gun parts to disposal, scraps which Keyser Soze had secretly arranged to be rerouted to&nbsp;Belfast.",
            "Related event 1": "9",
            "Related event 2": "16",
            "Bg Image": "-50"
        },
        {
            "#": "8",
            "Run time": "41m 25s",
            "Movie time": "6 weeks ago",
            "Location": "New York",
            "Title": "Keaton discovered&nbsp;alive",
            "Description": "Following a tip-off, customs agent Dave Kujan finds Keaton, who had been presumed dead, eating at Mondino’s with his attorney, However, Kujan has no grounds to arrest him and lets him&nbsp;go.",
            "Bg Image": "-50"
        },
        {
            "#": "9",
            "Section": "NYPD Revenge Scheme",
            "Run time": "5m 25s",
            "Movie time": "6 weeks ago",
            "Title": "Keaton, Fenster, McManus, Hockney, Verbal (the Five) arrested for truck&nbsp;hijacking",
            "Description": "They are detained, placed in a lineup, and questioned individually by the NYPD. It is revealed that Keyser Soze and his lawyer, Kobayashi, had arranged for all five arrests, and were planning on meeting them at the police station. However, due to the legal efforts of Edie Finneran, who is also Keaton’s girlfriend, they are all released before Soze and/or Kobayashi can&nbsp;arrive.",
            "Related event 1": "7",
            "Related event 2": "16",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "10",
            "Run time": "14m 55s",
            "Movie time": "6 weeks ago ",
            "Title": "The Five hatch plan to get revenge on police following&nbsp;release",
            "Description": "While being held in the same cell, McManus, Fenster, Hockney, and Verbal decide to team up and exact revenge on the NYPD. After their collective release, Verbal shows up at Edie's apartment and convinces Keaton to join in. The Five come up with an ambitious plan to expose police&nbsp;corruption.",
            "Bg Image": "-50",
            "Image A": "-50"
        },
        {
            "#": "11",
            "Run time": "31m 20s",
            "Movie time": "5 weeks ago",
            "Title": "The Five intercept emerald smuggler, expose police&nbsp;racketeering",
            "Description": "When McManus’s friend, a police officer of the defunct “New York’s finest taxi service” (a  police racket that escorted criminals in police cruisers in return for cash payment), picks up an emerald smuggler at the airport, the Five cut-off the police cruiser, set it on fire, and take the money and jewels. Then, they tip off the press and the&nbsp;police.</p><p>By Sunday, corrupt NYPD officers Strausz and Rizzi are indicted. A few weeks later, 50 other police officers are accused of&nbsp;corruption.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-53"
        },
        {
            "#": "12",
            "Section": "L.A. Diamond Heist",
            "Run time": "43m 0s",
            "Movie time": "1 week ago",
            "Location": "Los Angeles",
            "Title": "The Five sell emeralds to Redfoot in Los Angeles, agree to another&nbsp;job",
            "Description": "In Los Angeles, a dealer named Redfoot pays the Five for the emeralds and offers them a new job, to conduct a diamond heist involving jeweler Saul Berg. It is later revealed that Kobayashi had ordered the job. Keaton reveals to Redfoot that he killed Spook Hollis (a mobster who worked for Redfoot) in prison for personal and business&nbsp;reasons.",
            "Related event 1": "2",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "13",
            "Run time": "46m 15s",
            "Movie time": "6 days ago",
            "Title": "The Five botch diamond&nbsp;robbery",
            "Description": "The holdup gets messy when Saul Berg and his two bodyguards are killed. The Five recover a briefcase with no jewels or cash, only&nbsp;narcotics.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "14",
            "Run time": "49m 40s",
            "Movie time": "6 days ago",
            "Title": "Kobayashi requests meeting with the&nbsp;Five",
            "Description": "Kobayashi, who had ordered the job, calls Redfoot to ask if he can meet the Five in&nbsp;person."
        },
        {
            "#": "15",
            "Run time": "49m 0s",
            "Movie time": "5 days ago",
            "Title": "The Five confront Redfoot about botched&nbsp;robbery",
            "Description": "The Five have a hostile encounter with Redfoot over the failed diamond heist. He directs them to meet Kobayashi, the client who had requested the job in the first&nbsp;place.",
            "Bg Image": "-50",
            "Image A": "-48",
            "Image B": "-45"
        },
        {
            "#": "16",
            "Section": "Kobayashi Encounters",
            "Run time": "52m 10s",
            "Movie time": "4 days ago",
            "Title": "Kobayashi meets the Five, blackmails them into taking third&nbsp;job",
            "Description": "Kobayashi meets the Five and introduces himself as the lawyer of Keyser Soze. On behalf of Soze, he thanks the Five for killing the jeweler, and admits to being responsible for their arrests in New York. Kobayashi claims that the Five have stolen from Soze at different points in the past, and orders them to repay Soze by raiding a ship to sabotage a $91-million cocaine deal between the Hungarian and Argentinian&nbsp;mobs.</p><p>In reward for destroying the cocaine, he allows them to recover the cash meant for the deal, and promises them freedom from Soze’s influence. However, he threatens the Five with serious consequences for non-compliance.",
            "Related event 1": "1",
            "Related event 2": "5",
            "Related event 3": "6",
            "Related event 4": "7",
            "Related event 5": "9",
            "Bg Image": "-50",
            "Image A": "-45",
            "Image B": "-48"
        },
        {
            "#": "17",
            "Run time": "1h 4m 45s",
            "Movie time": "4 days ago",
            "Title": "Fenster ditches, found dead on&nbsp;beach",
            "Description": "In the middle of the night, Fenster ditches McManus, Hockney, Keaton, and Verbal, taking a cut of the money with him. He is murdered, presumably by Keyser Soze's men. The remaining Four are tipped off and find him dead near a cave on the seashore. They swear to disobey Kobayashi’s orders for the ship raid and pledge to assassinate&nbsp;him.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-49"
        },
        {
            "#": "18",
            "Run time": "1h 10m 45s",
            "Movie time": "4 days ago",
            "Title": "Edie Finneran arrives in Los Angeles to advise on Arturo Marquez’s&nbsp;extradition",
            "Description": "On Kobayashi’s request, Edie Finneran flies from New York to assist as Arturo Marquez’s extradition&nbsp;advisor.",
            "Related event 1": "4",
            "Related event 2": "20",
            "Related event 3": "21",
            "Related event 4": "24",
            "Bg Image": "-50",
            "Image A": "-50"
        },
        {
            "#": "19",
            "Run time": "1h 7m 35s",
            "Movie time": "3 days ago",
            "Title": "The Four ambush Kobayashi in office&nbsp;tower",
            "Description": "The Four set up a trap in the lawyer Kobayashi’s office tower. They ambush and capture him as he arrives for work, but decide not to kill him when he reveals that Edie Finneran has arrived to meet him and also issues various threats against their family&nbsp;members.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "20",
            "Section": "Ship Raid",
            "Run time": "1h 33m 5s",
            "Movie time": "A couple days ago",
            "Location": "San Pedro",
            "Title": "The Argentinians recapture Arturo Marquez, arrive for deal with Hungarian&nbsp;mob",
            "Description": "It is later revealed that the Argentinians had agreed to sell Arturo Marquez to the Hungarians in exchange for cash, since Marquez was the only person who could identify Keyser&nbsp;Soze.",
            "Related event 1": "4",
            "Related event 2": "20",
            "Related event 3": "24",
            "Related event 4": "28",
            "Related event 5": "29",
            "Bg Image": "-50",
            "Image A": "-50"
        },
        {
            "#": "21",
            "Run time": "1h 34m 45s",
            "Movie time": "Yesterday",
            "Location": "Pennsylvania",
            "Title": "Edie Finneran found dead in Pennsylvania&nbsp;hotel",
            "Description": "Edie Finneran is shot twice by unknown perpetrators, who may have been affiliated with Keyser Soze and&nbsp;Kobayashi.",
            "Related event 1": "4",
            "Related event 2": "9",
            "Related event 3": "18",
            "Related event 4": "19"
        },
        {
            "#": "22",
            "Run time": "1h 14m 20s",
            "Movie time": "Last night",
            "Location": "San Pedro",
            "Title": "Keaton, Hockney, McManus storm ship to thwart \"cocaine\"&nbsp;deal",
            "Description": "Ahead of their attack, the Four stake out the harbour. As the Hungarian mob arrives, Keaton orders Verbal to stay behind and stay alive to tell Edie everything. After detonating a bomb, Hockney and McManus shoot at various Hungarian and Argentinian mobsters on the ship deck and gangplank to allow Keaton to board the&nbsp;ship.</p><p>As they are searching the ship hold, Keaton and McManus are unable to find the cocaine that Kobayashi had ordered them to&nbsp;destroy. ",
            "Related event 1": "0",
            "Related event 2": "16",
            "Related event 3": "20",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-58"
        },
        {
            "#": "23",
            "Run time": "1h 21m 15s",
            "Movie time": "Last night",
            "Title": "Hockney shot by Keyser Soze while recovering Hungarians’&nbsp;cash ",
            "Description": "Hockney finds the Hungarian mob’s money in the back of a delivery truck on the shore, but is shot by Verbal/Keyser Soze.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "24",
            "Run time": "1h 27m 50s",
            "Movie time": "Last night",
            "Title": "Keyser Soze boards ship, kills Arturo&nbsp;Marquez",
            "Description": "While being held by the Argentinian mob in a bedroom on the ship, Arturo Marquez tells the mobster guarding his room that Keyser Soze is on board the ship. Verbal/Keyser Soze enters Marquez’s room and shoots him dead to protect his identity, since Marquez is the only person who can identify&nbsp;him.",
            "Related event 1": "4",
            "Related event 2": "18",
            "Related event 3": "20",
            "Related event 4": "29",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-55"
        },
        {
            "#": "25",
            "Run time": "1h 28m 55s",
            "Movie time": "Last night",
            "Title": "McManus is killed while looking for cocaine&nbsp;shipment",
            "Description": "While searching the ship, McManus is stabbed in the neck, presumably by Verbal/Keyser Soze.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-60"
        },
        {
            "#": "26",
            "Run time": "2m 20s / 1h 29m 45s",
            "Movie time": "Midnight",
            "Title": "Keyser Soze kills Keaton, sets ship on&nbsp;fire",
            "Description": "Verbal/Keyser Soze shoots Keaton on the deck of ship, paralyzing him. After a short conversation, Soze kills Keaton and lights the ship on fire with spilled a gasoline and a lit cigarette. The fire kills almost all the remaining surviors on&nbsp;board.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "27",
            "Section": "The Aftermath",
            "Run time": "17m 0s / 22m 15s",
            "Movie time": "This morning",
            "Title": "Firefighters extinguish ship fire, Verbal is arrested,&nbsp;questioned",
            "Description": "Verbal is detained and brought to the San Pedro police station. After flying from New York to California on short notice, Agent Kujan meets Verbal in the police station and questions him. Verbal recounts the events leading up to the&nbsp;fire.",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "28",
            "Run time": "20m 20s / 39m 35s",
            "Movie time": "This morning",
            "Title": "Hungarian mobster Arkosh Kovash rescued, questioned at&nbsp;hospital",
            "Description": "Hungarian mobster Arkosh Kovash is found alive near the ship wreckage and brought to the hospital in critical condition. FBI agent Jack Baer questions Kovash, who claims to have seen Keyser Soze on the ship. Kovash reveals that the deal between the Hungarians and the Argentinians was for people, not&nbsp;narcotics.</p><p>After interrogating Kovash and starting to build facial composite of Soze based on Kovash's testimony, Baer comes into the police station, tells Agent Kujan about the&nbsp;deal.",
            "Related event 1": "20",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "29",
            "Run time": "1h 22m 50s",
            "Movie time": "This morning",
            "Title": "Arturo Marquez’s body identified, recovered from&nbsp;ship",
            "Description": "Agent Baer reports to Agent Kujan at the police station, saying that Arturo Marquez was shot twice and blown clear of the ship during the&nbsp;explosion.",
            "Related event 1": "4",
            "Related event 2": "18",
            "Related event 3": "20",
            "Related event 4": "24",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "30",
            "Run time": "1h 34m 17s / 1h 37m 10s",
            "Movie time": "Noon",
            "Title": "Agent Kujan concludes Keaton was Keyser Soze, Verbal leaves on&nbsp;bail",
            "Description": "Verbal testifies that he witnessed Keyser Soze killing Keaton. Agent Kujan theorizes that Keaton is Soze, and manipulated McManus, Fenster, Hockney, and Verbal into helping him so he could complete his personal mission to kill Arturo Marquez, the only person who could identify him. Even though Verbal agrees, he refuses to testify against Keaton and leaves on bail. He is picked up by Kobayashi a block from the police station and driven&nbsp;away.",
            "Related event 1": "24",
            "Related event 2": "26",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        },
        {
            "#": "31",
            "Run time": "1h 39m 15s",
            "Movie time": "Noon",
            "Title": "Agent Kujan realizes Verbal is Keyser&nbsp;Soze",
            "Description": "Agent Kujan realizes Verbal is Keyser Soze, and had been fabricating his whole cover story based on details in the room, including the names \"Redfoot\" and \"Kobayashi\". As the facial composite of Keyser Soze is finally completed and is faxed to the police station, he runs outside looking for Verbal, but it is too&nbsp;late.",
            "Related event 1": "27",
            "Related event 2": "28",
            "Bg Image": "-50",
            "Image A": "-50",
            "Image B": "-50"
        }
    ]
// see Excel file for reference

// this for loop populates the HTML page, just collapse it
for (i = 0; i < data.length; i++) {

    var content1 = '<article class="container-fluid inactive" id="event-' + [i] + '"><div class="row rowheight"><div class="col-md-8 col-lg-8 columnheight"><div class="text-layout"><div class="line"></div><div class="time-frame"><h2 class="movie-time">' + data[i]["Movie time"] + '</h2><h2 class="run-time">' + data[i]["Run time"] + '</h2></div><div class="heading-frame"><h1 class="small">' + data[i]["Title"] + '</h1></div><div class="slider"><div class="p-frame"><div class="line-hover"></div><p class="regular">' + data[i]["Description"] + '</p></div>';

    var content2 = '';

    // var relatedTitles = [data[data[i]["Related event 1"]]["Title"], data[data[i]["Related event 1"]]["Title"], data[data[i]["Related event 1"]]["Title"], data[data[i]["Related event 1"]]["Title"], data[data[i]["Related event 1"]]["Title"]];

    if (data[i]["Related event 1"]) {

        var relatedTitle1 = data[data[i]["Related event 1"]]["Title"];

        content2 = '<div class="related-frame"><div class="line-hover"></div><div class="related-title"><h2>Related events</h2><img src="img/arrow.svg"></div>';
        content2 = content2 + '<div class="related-event rel-' + data[i]["Related event 1"] + '"><div class="related-bullet"></div><p class="footnote">' + relatedTitle1 + '</p></div>';

        if (data[i]["Related event 2"]) {

            var relatedTitle2 = data[data[i]["Related event 2"]]["Title"];

            content2 = content2 + '<div class="related-event rel-' + data[i]["Related event 2"] + '"><div class="related-bullet"></div><p class="footnote">' + relatedTitle2 + '</p></div>';

            if (data[i]["Related event 3"]) {

                var relatedTitle3 = data[data[i]["Related event 3"]]["Title"];

                content2 = content2 + '<div class="related-event rel-' + data[i]["Related event 3"] + '"><div class="related-bullet"></div><p class="footnote">' + relatedTitle3 + '</p></div>';

                if (data[i]["Related event 4"]) {

                    var relatedTitle4 = data[data[i]["Related event 4"]]["Title"];

                    content2 = content2 + '<div class="related-event rel-' + data[i]["Related event 4"] + '"><div class="related-bullet"></div><p class="footnote">' + relatedTitle4 + '</p></div>';

                    if (data[i]["Related event 5"]) {

                        var relatedTitle5 = data[data[i]["Related event 5"]]["Title"];

                        content2 = content2 + '<div class="related-event rel-' + data[i]["Related event 5"] + '"><div class="related-bullet"></div><p class="footnote">' + relatedTitle5 + '</p></div>';

                    }
                }
            }
        }
        content2 = content2 + '</div>';
    }

    var content3 = '</div></div></div><div class="col-md-4 col-lg-4 columnheight"><div class="image-layout">';

    var content4 = '';

    if (data[i]["Image A"]) {
        content4 = '<div class="image-A"><div class="image-overlay"></div><img src="img/scenes/ev' + [i + 1] + '-1.jpg" style="transform: translateX(' + data[i]["Image A"] + '%);"></div>';

        if (data[i]["Image B"]) {
            content4 = content4 + '<div class="image-B"><div class="image-overlay"></div><img src="img/scenes/ev' + [i + 1] + '-2.jpg" style="transform: translateX(' + data[i]["Image B"] + '%)"></div>';
        }
    }

    var content5 = '</div></div></div></article>';

    document.getElementById("article-content").insertAdjacentHTML("beforeend", content1 + content2 + content3 + content4 + content5);
}

// the current "active" event the user is viewing
var active = 0;
var activeChapter = 1;

// plan to use to indicate origin event during a transition
var wasActive;

// this variable activates a line inside slidedownBrighten() only when the page is first loaded.
var loading = true;

// I want to use this variable to add a delay before the user can click the up/down button again.
var beforeNext = false;

// slideUp/slideDown timing
var sliderTime = 550;

// on load
$(document).ready(function () {
    addGradients();
    changeEvent();
});

// on resize of viewport
var allowResize = true;
$(window).resize(function () {
    if (allowResize == true) {
        allowResize = false;
        addGradients();
        setTimeout(function () {
            allowResize = true;
        }, 1000);
    }
});

function changeEvent() {
    slideupDim();
    scrolltoActive();
    changeChapter();
    changeMarker();
    addBg();
    slidedownBrighten();
}

function slideupDim() {
    // changes the class of all events, and slides all of them up (collapsing them)
    $('article').addClass('inactive');
    $('article').fadeTo(300, 1);

    $('.slider').slideUp(sliderTime);
    $('.image-layout').slideUp(sliderTime);
}

function scrolltoActive() {
    // this function SHOULD scroll to the active event (which would be a  <article> with a specific id such as "event-2", if the variable active = 2) aligning the top of the <article> to the top of <main>
    setTimeout(function () {
        var firstPos = $('#event-0').offset().top;
        var parentPos = $('#article-content').offset().top;
        var targetPos = $('#event-' + active).offset().top;
        $('main').animate({ scrollTop: targetPos - firstPos }, 1000);
    }, 600);
}

function changeChapter() {
    // based on the variable active, this function should add a class to the current chapter, and remove a class from all the others.
    setTimeout(function () {
        if (active == 0) {
            activeChapter = 1;
        }
        else if (active >= 1 && active <= 8) {
            activeChapter = 2;
        }
        else if (active >= 9 && active <= 11) {
            activeChapter = 3;
        }
        else if (active >= 12 && active <= 15) {
            activeChapter = 4;
        }
        else if (active >= 16 && active <= 19) {
            activeChapter = 5;
        }
        else if (active >= 20 && active <= 26) {
            activeChapter = 6;
        }
        else if (active >= 27 && active <= 31) {
            activeChapter = 7;
        }

        $('.chapter').removeClass('active');
        $('.events-section').children('.event-marker').removeClass('hover');
        $('#c-' + activeChapter).addClass('active');
        $('#s-' + activeChapter).children('.event-marker').addClass('hover');
    }, 600);
}

function changeMarker() {
    setTimeout(function () {
        $('.event-marker').removeClass('active');
        $('#ev-' + active).addClass('active');
    }, 600);
}

function addBg() {
    if (data[active]["Bg Image"]) {
        var getBg = document.getElementById('bg');
        getBg.insertAdjacentHTML('beforeend', '<img src="img/scenes/ev' + (active + 1) + '-0.jpg" style = "transform: translateX(' + data[active]["Bg Image"] + '%)">');

        $('#bg').children('img:last-of-type').delay(600).fadeTo(300, 1);
        setTimeout(function () {
            $('#bg').children('img:first-of-type').remove();
        }, 2000);
    }
    else {
        $('#bg').children('img').fadeTo(300, 0);
    }
}

function slidedownBrighten() {
    // changes the class of only the active event, and slides it down (expanding it)
    var getActive = '#event-' + active;
    $(getActive).children('.row').children('div').children('.text-layout').children('.slider').delay(sliderTime + 400).slideDown(sliderTime);
    $(getActive).children('.row').children('div').children('.image-layout').delay(sliderTime + 400).slideDown(sliderTime, function () {
        // highlight active event, fadeout others
        $(getActive).removeClass('inactive');
        $('article').not(getActive).fadeTo(300, 0.35, beforeNext = false);

        if (loading == true) {
            loading = false;
            $('.intro-textbox').delay(300).fadeOut(1000);
            $('.intro').delay(300).slideUp(1000);
        }
    });
}

// adding text fade for overflowed items.
function addGradients() {
    for (i = 0; i < data.length; i++) {
        var pFrame = $('#event-' + i).children('.row').children('div').children('.text-layout').children('.slider').children('.p-frame');
        var pHeight = pFrame.children('p').outerHeight();
        var lineHeight = parseFloat(pFrame.children('p').css('line-height'));
        var linesLength = pHeight / lineHeight;

        if (linesLength > 4) {
            // must change -webkit-mask-image or mask-image: none setting in p-frame:hover
            pFrame.css('-webkit-mask-image', '-webkit-gradient(linear, left 55%, left bottom, from(rgba(0,0,0,1)), to(rgba(0,0,0,0.1)))');
            pFrame.addClass('gradient');
        }
    }
}

// when user hovers over collapsed description
$('.p-frame').hover(function () {
    $(this).css('-webkit-mask-image', '');
}, function () {
    var maskedClass = $(this).attr('class')
    if (maskedClass == 'p-frame gradient') {
        $(this).css('-webkit-mask-image', '-webkit-gradient(linear, left 55%, left bottom, from(rgba(0,0,0,1)), to(rgba(0,0,0,0.1)))');
    }
});





// when user clicks inactive event 
$('.container-fluid.inactive').click(function () {
    if (relatedHover == false && beforeNext == false) {
        var clickedId = $(this).attr('id');
        var activeId = $('#event-' + active).attr('id');
        if (clickedId !== activeId) {
            beforeNext = true;
            active = parseInt(clickedId.replace('event-', ''));
            changeEvent();
        }
    }
});

// whether mouse is hovering over a related event, what to do on hover
var relatedHover = false;
$('.related-event').hover(function () {
    relatedHover = true;
    var hoveredClass = $(this).attr('class');
    $('#ev-'+parseInt(hoveredClass.replace('related-event rel-', ''))).addClass('active');
}, function () {
    relatedHover = false;
    var hoveredClass = $(this).attr('class');
    $('#ev-'+parseInt(hoveredClass.replace('related-event rel-', ''))).removeClass('active');
});

// when user clicks related event
$('.related-event').click(function () {
    if (beforeNext == false) {
        beforeNext = true;
        var clickedClass = $(this).attr('class');
        active = parseInt(clickedClass.replace('related-event rel-', ''));
        changeEvent();
    }
});

// when user clicks up arrow
var upArrow = document.getElementById('up');
upArrow.onclick = function () {
    if (beforeNext == false && active > 0) {
        beforeNext = true;
        active = active - 1;
        changeEvent();
    }
}

// when user clicks down arrow
var downArrow = document.getElementById('down');
downArrow.onclick = function () {
    if (beforeNext == false && active < 31) {
        beforeNext = true;
        active = active + 1;
        changeEvent();
    }
}

// when user hovers over chapters (some done with CSS :hover)
// if time should shorten using event.target and .length

$('#c-1').hover(function () {
    for (i = 0; i <= 0; i++) {
        $('#ev-' + i).addClass('hover');
    }
}, function () {
    if (activeChapter !== 1) {
        for (i = 0; i <= 0; i++) {
            $('#ev-' + i).removeClass('hover');
        }
    }
});

$('#c-2').hover(function () {
    for (i = 1; i <= 8; i++) {
        $('#ev-' + i).addClass('hover');
    }
}, function () {
    if (activeChapter !== 2) {
        for (i = 1; i <= 8; i++) {
            $('#ev-' + i).removeClass('hover');
        }
    }
});

$('#c-3').hover(function () {
    for (i = 9; i <= 11; i++) {
        $('#ev-' + i).addClass('hover');
    }
}, function () {
    if (activeChapter !== 3) {
        for (i = 9; i <= 11; i++) {
            $('#ev-' + i).removeClass('hover');
        }
    }
});

$('#c-4').hover(function () {
    for (i = 12; i <= 15; i++) {
        $('#ev-' + i).addClass('hover');
    }
}, function () {
    if (activeChapter !== 4) {
        for (i = 12; i <= 15; i++) {
            $('#ev-' + i).removeClass('hover');
        }
    }
});

$('#c-5').hover(function () {
    for (i = 16; i <= 19; i++) {
        $('#ev-' + i).addClass('hover');
    }
}, function () {
    if (activeChapter !== 5) {
        for (i = 16; i <= 19; i++) {
            $('#ev-' + i).removeClass('hover');
        }
    }
});

$('#c-6').hover(function () {
    for (i = 20; i <= 26; i++) {
        $('#ev-' + i).addClass('hover');
    }
}, function () {
    if (activeChapter !== 6) {
        for (i = 20; i <= 26; i++) {
            $('#ev-' + i).removeClass('hover');
        }
    }
});

$('#c-7').hover(function () {
    for (i = 27; i <= 31; i++) {
        $('#ev-' + i).addClass('hover');
    }
}, function () {
    if (activeChapter !== 7) {
        for (i = 27; i <= 31; i++) {
            $('#ev-' + i).removeClass('hover');
        }
    }
});

// when user clicks chapters

$('#c-1').click(function () {
    if (beforeNext == false && active !== 0) {
        beforeNext = true;
        active = 0;
        changeEvent();
    }
});

$('#c-2').click(function () {
    if (beforeNext == false && (active < 1 || active > 8)) {
        beforeNext = true;
        active = 1;
        changeEvent();
    }
});

$('#c-3').click(function () {
    if (beforeNext == false && (active < 9 || active > 11)) {
        beforeNext = true;
        active = 9;
        changeEvent();
    }
});

$('#c-4').click(function () {
    if (beforeNext == false && (active < 12 || active > 15)) {
        beforeNext = true;
        active = 12;
        changeEvent();
    }
});

$('#c-5').click(function () {
    if (beforeNext == false && (active < 16 || active > 19)) {
        beforeNext = true;
        active = 16;
        changeEvent();
    }
});

$('#c-6').click(function () {
    if (beforeNext == false && (active < 20 || active > 26)) {
        beforeNext = true;
        active = 20;
        changeEvent();
    }
});

$('#c-7').click(function () {
    if (beforeNext == false && (active < 27 || active > 31)) {
        beforeNext = true;
        active = 27;
        changeEvent();
    }
});